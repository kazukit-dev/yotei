# Yotei Development Guidelines

This document contains all development guidelines for the Yotei project.

## General Coding Standards

- Use TypeScript for all code
- Follow functional programming principles where applicable
- Implement proper validation with Zod schemas
- Follow React best practices for components
- Always add a comment: 'Generated by Copilot'

## API Development Guidelines

### Error Handling

- Use neverthrow Result types for error handling in API
- Handle errors gracefully with neverthrow

### Validation

- Validate all inputs with Zod
- Use proper HTTP status codes

### Testing & Validation

- **Mandatory for API changes**: Run `pnpm run test:api` and `pnpm run check:api`
- Always run tests after making API changes: `pnpm test:all`

## Frontend Development Guidelines

### Components

- Use Remix conventions for routing and data loading
- Implement proper loading states
- Use React Aria Components for accessibility
- Follow component composition patterns

### Styling

- Use Tailwind CSS for styling
- Follow consistent naming conventions

## Command Execution Guidelines

### Working Directory

- **Always execute commands from the project root directory**: `/Users/kazuki/developments/yotei/`
- Use workspace-aware commands to target specific apps/packages
- Avoid navigating to subdirectories to run commands

### Command Structure

```bash
# From project root - CORRECT
pnpm run test:api
pnpm run check:api
pnpm --filter ./apps/api test

# From subdirectory - AVOID
cd apps/api && pnpm test
```

## Package Management Guidelines

### pnpm Workspace

- Use pnpm as the package manager for the monorepo
- Leverage workspace protocol (`workspace:*`) for internal dependencies
- Manage dependencies at the appropriate level (root vs app-specific)

### Dependency Management

- **Root dependencies**: Shared tools (ESLint, Prettier, TypeScript)
- **App-specific dependencies**: Framework-specific packages in respective apps
- **Package dependencies**: Utilities and shared configurations in packages/

### Commands

- Install dependencies: `pnpm install`
- Add dependency to specific app: `pnpm --filter ./apps/api add <package>`
- Add dev dependency: `pnpm --filter ./apps/api add -D <package>`
- Remove dependency: `pnpm --filter ./apps/api remove <package>`
- Update dependencies: `pnpm update`
- Run scripts in specific app: `pnpm --filter ./apps/api <script>`

### Root Workspace Operations

- Add root dependency (shared tools): `pnpm add -w <package>`
- Add root dev dependency: `pnpm add -D -w <package>`
- Remove root dependency: `pnpm remove -w <package>`
- Run script in all workspaces: `pnpm -r <script>`
- Run script in all workspaces (parallel): `pnpm -r --parallel <script>`
- Install dependencies for all workspaces: `pnpm install`
- Update all workspace dependencies: `pnpm update -r`

### Workspace Structure

- `apps/api/` - Backend API application
- `apps/web/` - Frontend web application
- `packages/eslint-config/` - Shared ESLint configurations

## Database Guidelines

### ORM

- Use Drizzle ORM for database operations
- Write migrations for schema changes
- Follow naming conventions for tables and columns

### Migrations

- Generate migrations with Drizzle Kit
- Test migrations locally before deployment

## Testing Guidelines

### Test Strategy

- **Focus on business logic**: Test domain objects and workflows primarily
- **Skip infrastructure layers**: query-services and repositories don't need unit tests
- **Use integration tests**: For data layer and end-to-end scenarios
- See detailed guidelines: [Testing Guidelines](./testing-guidelines.md)

### Test File Conventions

- **File naming**: Use `*.spec.ts` pattern only (`.test.ts` is prohibited)
- **File location**: Colocate test files with source files in the same directory
- **Examples**:
  - ✅ `calendar.spec.ts` (in same directory as `calendar.ts`)
  - ❌ `calendar.test.ts` or separate test directories

### Test Commands

- **For API development**: `pnpm run test:api` (unit tests) and `pnpm run check:api` (quality checks)
- Run all tests: `pnpm test:all`
- Run API tests: `pnpm --filter ./apps/api test`
- Run tests in watch mode: `pnpm --filter ./apps/api test:watch`

## Architecture Patterns

### Backend

- Domain-Driven Design: Features organized by domain modules
- Workflow Pattern: Business logic encapsulated in workflows
- Repository Pattern: Data access layer abstraction
- Clean Architecture: Clear separation of concerns

### Frontend

- Component-Based: Reusable UI components
- File-Based Routing: Remix routing conventions
- API Client Layer: Centralized API communication
- Query Management: TanStack Query for server state
